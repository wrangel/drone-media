<!doctype html>
<html>
	<head>
		<!-- for optimal display on high DPI devices -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/core/index.min.css" />
		<link rel="stylesheet" href="css/pano-viewer.css">
		<link rel="icon" type="image/x-icon" href="media/icons/favicon/favicon.ico">
		
		<script src="https://cdn.jsdelivr.net/npm/three/build/three.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/core/index.min.js"></script>
		<script src=" https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/autorotate-plugin@5.1.1/index.min.js "></script>
		
	</head>
	
	<body>
		<div class="outer-box">
			<!-- the viewer container must have a defined size -->
			<div id="viewer"></div>
		</div>
		
		<script type="text/template" id="fisheye-icon">
			<?xml version="1.0" standalone="no"?>
			<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"
			 "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
			<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
			 width="980.000000pt" height="980.000000pt" viewBox="0 0 980.000000 980.000000"
			 preserveAspectRatio="xMidYMid meet">
			<g transform="translate(0.000000,980.000000) scale(0.100000,-0.100000)"
			fill="#ffffff" stroke="none">
			<path d="M4560 9789 c-1035 -75 -1998 -463 -2800 -1128 -150 -123 -501 -475
			-622 -621 -881 -1068 -1270 -2403 -1098 -3765 119 -934 501 -1801 1124 -2545
			98 -117 370 -393 496 -504 1328 -1166 3158 -1531 4825 -962 895 305 1700 879
			2281 1627 540 695 884 1519 993 2384 179 1408 -248 2798 -1185 3865 -112 128
			-386 398 -509 501 -761 641 -1667 1026 -2665 1134 -174 19 -664 27 -840 14z
			m752 -204 c390 -34 703 -99 1078 -225 1509 -503 2662 -1738 3064 -3280 110
			-422 152 -794 143 -1270 -5 -284 -17 -442 -53 -660 -310 -1935 -1811 -3489
			-3733 -3864 -355 -70 -604 -90 -1001 -83 -401 7 -676 41 -1026 127 -1787 439
			-3157 1878 -3503 3680 -58 304 -81 551 -81 890 0 659 124 1269 377 1854 697
			1609 2191 2684 3943 2835 164 14 612 12 792 -4z"/>
			<path d="M4740 8194 c-734 -50 -1322 -271 -1890 -710 -143 -110 -408 -373
			-525 -519 -395 -496 -635 -1068 -711 -1700 -23 -190 -23 -560 0 -750 91 -753
			412 -1419 941 -1951 384 -386 816 -653 1320 -817 353 -115 642 -160 1025 -160
			511 0 951 97 1411 312 521 242 1007 662 1341 1158 587 875 716 2003 343 2998
			-160 427 -398 801 -725 1139 -531 548 -1236 895 -1990 980 -137 16 -440 27
			-540 20z m500 -718 c390 -53 777 -198 1100 -414 392 -261 693 -604 900 -1027
			441 -897 330 -1960 -288 -2754 -89 -114 -264 -294 -382 -393 -282 -238 -664
			-432 -1025 -524 -795 -203 -1632 -21 -2280 495 -102 82 -276 252 -367 361
			-237 282 -433 665 -525 1025 -153 603 -88 1230 186 1790 316 644 874 1124
			1561 1343 176 56 372 95 565 112 129 11 420 4 555 -14z"/>
			<path d="M4690 6770 c-132 -17 -242 -41 -375 -85 -297 -97 -535 -243 -755
			-464 -841 -844 -695 -2257 301 -2911 218 -143 452 -236 724 -287 113 -21 397
			-28 525 -14 759 87 1396 624 1605 1351 49 170 66 285 72 475 12 397 -91 766
			-304 1090 -84 128 -242 315 -265 315 -4 0 -15 -14 -24 -32 -25 -49 -103 -127
			-168 -170 -158 -103 -363 -109 -539 -16 -116 62 -225 209 -257 347 -19 83 -9
			222 23 301 15 35 23 68 19 71 -28 27 -437 46 -582 29z"/>
			</g>
			</svg>
		</script>

		
		<script> 
			const img = window.location.search.split('=')[1];
			const dfltZoom = 50;
			const panoMaxFov = 110; // 90, zoom out
			
			const animatedValues = {
				pitch: { start: -Math.PI / 2, end: 0.2 },
				yaw: { start: Math.PI, end: 0 },
				zoom: { start: 0, end: dfltZoom },
				fisheye: { start: 2, end: 0 },
			};
			
			const viewer = new PhotoSphereViewer.Viewer({
				container: document.querySelector('#viewer'),
				panorama: '../media/pano/' + img + '.jpeg',
				maxFov: panoMaxFov, 
				minFov: 10, // 30, zoom in
				defaultZoomLvl: dfltZoom,
				defaultPitch: animatedValues.pitch.start,
				defaultYaw: animatedValues.yaw.start,
				defaultZoomLvl: animatedValues.zoom.start,
				fisheye: animatedValues.fisheye.start,
				navbar: [
					'zoom',
					'fullscreen',
					{
						title: 'Rerun animation',
						content: 'ðŸ”„',
						onClick: intro,
					},
					{ // create custom button for fisheye
						id: 'fisheye',
						content: document.querySelector('#fisheye-icon').innerText,
						title: 'Fisheye view',
						className: 'fisheye-button',
						onClick: (viewer) => {
							autorotate.stop();
							viewer.setOptions({
								fisheye: true,
								maxFov: 150,
							});
						},
					},
					{ // create custom button for panorama
						id: 'panorama',
						content: 'P',
						title: 'Panorama view',
						className: 'panorama-button',
						onClick: (viewer) => {
							autorotate.start();
							viewer.setOptions({
								fisheye: 0,
								maxFov: panoMaxFov,
							});
						},
					},
				],
				plugins: [
					[PhotoSphereViewer.AutorotatePlugin, {
						autostartDelay: null,
						autostartOnIdle: false,
						autorotatePitch: animatedValues.pitch.end,
						autorotateSpeed: 0.11,
					}],
				],
			});
			
			const autorotate = viewer.getPlugin(PhotoSphereViewer.AutorotatePlugin);

			viewer.addEventListener('ready', intro, { once: true });
			
			function intro() {
				autorotate.stop();

				new PhotoSphereViewer.utils.Animation({
					properties: animatedValues,
					duration: 2500,
					easing: 'inOutQuad',
					onTick: (properties) => {
						viewer.setOption('fisheye', properties.fisheye);
						viewer.rotate({ yaw: properties.yaw, pitch: properties.pitch });
						viewer.zoom(properties.zoom);
					},
				}).then(() => {
					autorotate.start();
				});
			}
			
			// Clean up cache
			window.addEventListener('beforeunload', function () {
            	viewer.destroy();
        	});	
			
		</script>
	</body>
</html>
